## コンテナAPI
kubernetesをそう呼ぶ  
  
[[_TOC_]]

## 一章
kubernetesはスケーラブルなシステムを運用するための最適なサービスである  
そういったシステムを求める理由には、下記の要因のいずれかが該当するはず  
そしてkubernetesはそういった要因を実現する機能をもっている  
  
◆Velocity  
　・新しい機能を作る速度を上げる環境  
　・新機能の追加実装のしやすさ  
　・無停止でのアップデート  
  
◆システムインフラの在り方  
* ミュータブルなインフラ  
rpmによるパッケージや、ソースコードのコンパイルしてpath変更によるアップデートなど  
一つのシステムに変更を積み重ねて更新していくインフラのこと  
伝統的な手法  
* イミュータブルなインフラ   
稼働しているシステムの隣に新しいシステムを作成する。  
両者を入れ替える(切り替える)ことでシステムを更新していくインフラのこと
近代的な手法(kubernetesはこちら)  
  
後者の利点は大きい  
導入前の更新テスト環境を丸々作れるので、検証、再現がしやすい  
更新後問題発生時に旧システムが丸ごと残っているので、切り戻しが容易  
  
◆設定方法の特徴
```
命令的設定  
　A機:有効, B機:有効, C機:有効
宣言的設定(kubernetes)  
　有効なレプリカセット:3
```
設定内容の記載方法が状態をベースに指定されている  

◆自己回復するシステム  
宣言的な設定内容であることによって、障害発生時でも書かれている設定の状態に戻そうと
kubernetesは動作してくれる。(自己復元)  

◆効率性について
VMware, Xenserver, KVMなどは、仮想マシンの詰め方によって余りリソースができてしまう  
Kubernetesはどこにコンテナを置くかも管理してくれるので、余りリソースが少ない  
  
◆外部サービスについて
KaaS(Kubernetes as a Service)  
Microsoft AzureContainerService と Google Kubernetes engine が該当する  
ローカルでKubernetes用意するのが面倒であればこれらを使うことになる  
  
## 二章
KubernetesがオーケストレーションするシステムはDockerコンテナとなる  
DockerコンテナはHubでリソース管理もできるし、テストも環境に依存しない  
  
◆Dockerコンテナについて  
imageファイルから起動をすることで、特定のサービスを行わせることができる  
imageファイルには、OSに変更内容を記載したDockerファイルが付いてくる  
  
◆Dockerコンテナの記憶域について  
コンテナのファイルシステムは積層構造になっている  
Dockerファイルによる変更のたびに記憶域への変更内容が層となり上書きを行っている  
  
◆Dockerコンテナの管理について  
管理するときはイメージファイルにしてHubでアップロードする  
よってDockerファイルにパスワードなど個に依存した情報は書いてはいけない  
オープンではDockerHubというサービスがよい  
プライベートでは、GoogleContainerRegistryがよさそう  
  
◆コンテナごとのリソース使用量の制限  
便利な機能  
```
docker run -d -name kuard --publish 8080:8080 --memory 200mb --memory-swap 1G  \
 --cpu-shares 1024 gcr.io/kuar-demo/kuard-amd64:1
```
  



